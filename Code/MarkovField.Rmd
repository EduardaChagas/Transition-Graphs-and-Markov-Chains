---
title: "Gerando elementos sintéticos usando Grafos de Transição de padrões ordinais e medidas de dispersão"
author: "Eduarda Chagas"
date: "Mar 22, 2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
  html_notebook: default
---

Nesse presente experimento analisamos uma das limitações técnicas de análise de séries temporais baseadas em padrões ordinais: forecasts e simulações.
Para isso, exploramos aqui a possibilidade de utilização do grafos de transição como cadeias de markov para a geração de novos elementos em uma série temporal.

Nos limitamos nesse trabalho a analisar apenas palavras com $D = 3$ e $\tau = 1$.

O nosso algoritmo consiste basicamente em duas etapas:

1. Formar a matriz de transição de padrões ordinais das sequências e obter suas respectivas cadeias de Markov;

2. Cada sequência terá suas palavras associadas coletadas e analisadas para se obter estimativas de valor central (média) e medidas de dispersão (desvio padrão) de cada um dos três valores.

#### Carregando pacotes e scripts necessários

```{r}
if(!require(ggplot2)){
  install.packages("ggplot2")
  require(ggplot2)
} 
if(!require(ggthemes)){
  install.packages("ggthemes")
  require(ggthemes)
} 
if(!require(ggpubr)){
  install.packages("ggpubr")
  require(ggpubr)
} 
source("GenerateSequencies.R")
source("TransitionGraph.R")
```

#### Gerando sequências por meio de modelos autoregressivos

Para a realização dos experimentos aqui propostos, calculamos $50$ sequências geradas por modelos AR(1) com o seguinte número de elementos:

* $N = (10000, 100000)$,

e ao final de cada sequência estimamos $100$ novos valores utilizando o gerador baseado em padrões ordinais.

```{r}
N_seq = 50

N_init_10k = (10000 - 100) + 1
N_final_10k = 10000 + 1

N_init_100k = (100000 - 100) + 1
N_final_100k = 100000 + 1

ts.10k = read.csv('../Data/ts_10k.csv')
ts.100k = read.csv('../Data/ts_100k.csv')

new.ts.10k = read.csv('../Data/new_ts_10k.csv')
new.ts.100k = read.csv('../Data/new_ts_100k.csv')

watg.new.ts.10k = read.csv('../Data/watg_new_ts_10k.csv')
watg.new.ts.100k = read.csv('../Data/watg_new_ts_100k.csv')
```

Ao estimar os novos elementos da série temporal, assumimos que os elementos associados aos padrões ordinais seguem uma distribuição normal com média e desvio padrão estimados empiricamente a partir dos dados.
Desse modo, antes que aplicamos essa metodologia, verificamos se tal premissa pode ser considerada razoável para os dados utilizados.

```{r}
elements.pattern = patterns.hist(ts = unlist(ts.10k[10,]), symbol_index = 6)
ggdensity(as.vector(elements.pattern), main = "Density")
```
```{r}
ggqqplot(as.vector(elements.pattern))
```


# Time series generated by markov transition graph

```{r}
df.ts = data.frame(sequences = unlist(c(ts.10k[1, N_init_10k:N_final_10k], new.ts.10k[1, N_init_10k:N_final_10k], watg.new.ts.10k[1, (N_init_10k-2):(N_final_10k-2)])),
                index = rep(c(N_init_10k:N_final_10k), 3),
                type = c(rep('Original', length(N_init_10k:N_final_10k)), rep('TG Synthetic', length(N_init_10k:N_final_10k)), rep('WATG Synthetic', length(N_init_10k:N_final_10k))))

ggplot(data = df.ts) +
  geom_line(aes(x = index, y = sequences, color = type)) + 
  facet_grid(rows = vars(type)) + 
  theme_few()
```

#### Correlation TG

```{r}
cor.tg.10k = read.csv('../Data/cor_Distance_tg_10k.csv')[,2]
cor.tg.100k = read.csv('../Data/cor_Distance_tg_100k.csv')[,2]

df.cor.tg = data.frame(Distance = c(rep('10k', 50), rep('100k', 50)),
                Values = c(cor.tg.10k, cor.tg.100k))
```

```{r}
ggplot(data = df.cor.tg, aes(x = Distance, y = Values, fill = Values)) + 
    geom_boxplot() +
    xlab("class") +
    theme(legend.position="none") +
    xlab("") +
    xlab("")
```
#### Correlation WATG

```{r}
cor.watg.10k = read.csv('../Data/cor_Distance_watg_10k.csv')[,2]
cor.watg.100k = read.csv('../Data/cor_Distance_watg_100k.csv')[,2]

df.cor.watg = data.frame(Distance = c(rep('10k', 50), rep('100k', 50)),
                Values = c(cor.watg.10k, cor.watg.100k))
```

```{r}
ggplot(data = df.cor.watg, aes(x = Distance, y = Values, fill = Values)) + 
    geom_boxplot() +
    xlab("class") +
    theme(legend.position="none") +
    xlab("") +
    xlab("")
```


```{r}
df.patterns = data.frame(patterns = unlist(c(ts.pattern.10k[N_init_10k:N_final_10k], new.pattern.10k[N_init_10k:N_final_10k])),
                        index = rep(c(N_init_10k:N_final_10k), 2),
                        type = c(rep('Original', length(N_init_10k:N_final_10k)), 
                                 rep('Synthetic', length(N_init_10k:N_final_10k))))

ggplot(data = df.patterns) +
  geom_line(aes(x = index, y = patterns, color = type)) + 
  facet_grid(rows = vars(type)) + 
  theme_few()

```
