---
title: "Gerando elementos sintéticos usando Grafos de Transição de padrões ordinais e medidas de dispersão"
author: "Eduarda Chagas"
date: "Mar 22, 2020"
output:
  html_document:
    df_print: paged
  pdf_document: default
  html_notebook: default
---

Nesse presente experimento analisamos uma das limitações técnicas de análise de séries temporais baseadas em padrões ordinais: forecasts e simulações.
Para isso, exploramos aqui a possibilidade de utilização do grafos de transição como cadeias de markov para a geração de novos elementos em uma série temporal.

Nos limitamos nesse trabalho a analisar apenas palavras com $D = 3$ e $\tau = 1$.

O nosso algoritmo consiste basicamente em duas etapas:

1. Formar a matriz de transição de padrões ordinais das sequências e obter suas respectivas cadeias de Markov;

2. Cada sequência terá suas palavras associadas coletadas e analisadas para se obter estimativas de valor central (média) e medidas de dispersão (desvio padrão) de cada um dos três valores.

#### Carregando pacotes e scripts necessários

```{r}
if(!require(ggplot2)){
  install.packages("ggplot2")
  require(ggplot2)
} 
if(!require(ggthemes)){
  install.packages("ggthemes")
  require(ggthemes)
} 
source("GenerateSequencies.R")
source("TransitionGraph.R")
```

#### Gerando sequências por meio de modelos autoregressivos

Para a realização dos experimentos aqui propostos, calculamos $50$ sequências geradas por modelos AR(1) com o seguinte número de elementos:

* $N = (10000, 100000)$,

e ao final de cada sequência estimamos $100$ novos valores utilizando o gerador baseado em padrões ordinais.

```{r}
N_seq = 50

N_init_10k = (10000 - 100) + 1
N_final_10k = 10000 + 1

N_init_100k = (100000 - 100) + 1
N_final_100k = 100000 + 1

ts.10k = read.csv('../Data/ts_10k.csv')
ts.100k = read.csv('../Data/ts_100k.csv')

new.ts.10k = read.csv('../Data/new_ts_10k.csv')
new.ts.100k = read.csv('../Data/new_ts_100k.csv')

watg.new.ts.10k = read.csv('../Data/watg_new_ts_10k.csv')
watg.new.ts.100k = read.csv('../Data/watg_new_ts_100k.csv')

watg.new.ts.10k = watg.new.ts.10k[,3:10001]
watg.new.ts.100k = watg.new.ts.100k[,3:100001]
```

# Time series generated by markov transition graph

```{r}
df.ts = data.frame(sequences = unlist(c(ts.10k[1, N_init_10k:N_final_10k], new.ts.10k[1, N_init_10k:N_final_10k], watg.new.ts.10k[1, (N_init_10k-2):(N_final_10k-2)])),
                index = rep(c(N_init_10k:N_final_10k), 3),
                type = c(rep('Original', length(N_init_10k:N_final_10k)), rep('TG Synthetic', length(N_init_10k:N_final_10k)), rep('WATG Synthetic', length(N_init_10k:N_final_10k))))

ggplot(data = df.ts) +
  geom_line(aes(x = index, y = sequences, color = type)) + 
  facet_grid(rows = vars(type)) + 
  theme_few()
```

#### Correlation TG

```{r}
ccor.distance.10k = read.csv('Ccor_Distance_10k.csv')[,2]
ccor.distance.100k = read.csv('Ccor_Distance_100k.csv')[,2]

df.corr = data.frame(Distance = c(rep('10k', 50), rep('100k', 50)),
                Values = c(ccor.distance.10k, ccor.distance.100k))

ggplot(data = df.corr, aes(x = Distance, y = Values, fill = Values)) + 
    geom_boxplot() +
    xlab("class") +
    theme(legend.position="none") +
    xlab("") +
    xlab("")
```

#### Correlation WATG

```{r}
ccor.distance.10k = read.csv('Ccor_Distance_watg_10k.csv')[,2]
ccor.distance.100k = read.csv('Ccor_Distance_watg_100k.csv')[,2]

df.corr = data.frame(Distance = c(rep('10k', 50), rep('100k', 50)),
                Values = c(ccor.distance.10k, ccor.distance.100k))

ggplot(data = df.corr, aes(x = Distance, y = Values, fill = Values)) + 
    geom_boxplot() +
    xlab("class") +
    theme(legend.position="none") +
    xlab("") +
    xlab("")
```

```{r}
df.patterns = data.frame(patterns = unlist(c(ts.pattern.10k[N_init_10k:N_final_10k], new.pattern.10k[N_init_10k:N_final_10k])),
                        index = rep(c(N_init_10k:N_final_10k), 2),
                        type = c(rep('Original', length(N_init_10k:N_final_10k)), 
                                 rep('Synthetic', length(N_init_10k:N_final_10k))))

ggplot(data = df.patterns) +
  geom_line(aes(x = index, y = patterns, color = type)) + 
  facet_grid(rows = vars(type)) + 
  theme_few()

```
Correlation between patterns sequences:

```{r}
cor(df.ts.pattern$patterns, df.new.ts.pattern$patterns)
```


#### Analysis of synthetic elements generated

```{r}
N.initial = 1000

ts.partition = ts[N.initial:dim(ts)[1],]
new.ts.partition = new.ts[N.initial:dim(new.ts)[1],]

df.ts = data.frame(series = c(ts.partition$series, new.ts.partition$series),
                index = c(ts.partition$index, new.ts.partition$index),
                type = c(rep(1, dim(ts.partition)[1]), rep(2, dim(new.ts.partition)[1])))

Sequence = c('Original', 'Synthetic')[df.ts$type]

ggplot(data = df.ts) +
  geom_line(aes(x = index, y = series, color = Sequence)) +
  facet_grid(rows = vars(type)) + 
  theme_few()
```
Correlation between elements sequences:

```{r}
cor(ts.partition$series, new.ts.partition$series)
```


#### Aplicação da mediana como valor central